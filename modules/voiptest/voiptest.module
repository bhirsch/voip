<?php
/**
 * @file test Voip Drupal hooks.
 */ 

/**
 * Implementation of hook_voipcall_load_script()
 */
function voiptest_voipcall_load_script($voipcall, $script_name) {
  $script = NULL;
  if($script_name == 'voipcall_call_pickup') {
   $script = array();
   $script[] = array(VOIPCALL_CMDID => VOIPCALL_SAY,
                     'text' => array(VOIPCALL_VAL => "Hello world!"),
               );
/****
   $script[] = array(VOIPCALL_CMDID => VOIPCALL_SAY,
                     'text' => array(VOIPCALL_VAL => "Your number is "),
               );
   $script[] = array(VOIPCALL_CMDID => VOIPCALL_SAY,
                     'text' => array(VOIPCALL_VAR => 'caller_number'),
               );
****/
   $script[] = array(VOIPCALL_CMDID => VOIPCALL_SAY,
                     'text' => array(VOIPCALL_VAL => "Please leave a message after the beep.  When done, press the star key. "),
               );
   $script[] = array(VOIPCALL_CMDID => VOIPCALL_RECORD,
                     'max_length' => array(VOIPCALL_VAL => '20'),
                     'end_key' => array(VOIPCALL_VAL => '*'),
               );
   $script[] = array(VOIPCALL_CMDID => VOIPCALL_SAY,
                     'text' => array(VOIPCALL_VAL => "You said "),
               );
   $script[] = array(VOIPCALL_CMDID => VOIPCALL_PLAY,
                     'url' => array(VOIPCALL_VAR => 'recording_url'),
               );
//   $script[] = array(VOIPCALL_CMDID => VOIPCALL_PLAY,
//                     'url' => array(VOIPCALL_VAL => "http://api.twilio.com/Cowbell.mp3"),
//               );
   $script[] = array(VOIPCALL_CMDID => VOIPCALL_GATHER,
                     'text' => array(VOIPCALL_VAL => "Type your favorite number.  When done, press the pound key."),
                     'end_key' => array(VOIPCALL_VAL => "#"),
               );
   $script[] = array(VOIPCALL_CMDID => VOIPCALL_SAY,
                     'text' => array(VOIPCALL_VAL => "You pressed: "),
               );
   $script[] = array(VOIPCALL_CMDID => VOIPCALL_SAY,
                     'text' => array(VOIPCALL_VAR => "gather_digits"),
               );
   $script[] = array(VOIPCALL_CMDID => VOIPCALL_SAY,
                     'text' => array(VOIPCALL_VAL => "Dialing your cell number "),
               );
   $script[] = array(VOIPCALL_CMDID => VOIPCALL_DIAL,
                     'number' => array(VOIPCALL_VAL => "6177920995"),
               );
   $script[] = array(VOIPCALL_CMDID => VOIPCALL_SAY,
                     'text' => array(VOIPCALL_VAL => "Bye bye."),
               );
//   $script[] = array(VOIPCALL_CMDID => VOIPCALL_HANGUP);
  }
 return $script;
}



/**
 * Implementation of hook_voip_process_request().
 */
function voiptest_voip_process_request($request_id, $options) {
  $response = NULL;

  switch($request_id) {
    case 'voip_get_script':
      switch ($options['script_name']){
        case 'hello_world':
          $response['$request_id'] = $request_id;
          $response['$options'] = $options;
          $response['script_contents'] =
            '<?xml version="1.0"?>' . 
            "<voip_script name='hello_world'>
              <say><text>Hello, world!</text></say>
              <goto>bye_bye</goto>
            </voip_script>";
          break;
        case 'bye_bye':
          $response['$request_id'] = $request_id;
          $response['$options'] = $options;
          $response['script_contents'] =
            '<?xml version="1.0"?>' . 
            "<voip_script name='bye_bye'>
              <say><text>Nice meeting you.  Goodbye!</text></say>
              <hangup></hangup>
            </voip_script>";
          break;
      }
      break;
  }

  return $response;
}

/*
function voiptest_nodeapi(&$node, $op, $teaser, $page) {
  if ($op == 'view') {
    dsm($node);
  }
}
// */

/* 
function voiptest_form_alter(&$form, &$form_state, $form_id) {
// dsm($form_id);

  if ($form_id == 'node_type_form') {
    dsm($form);
   
    $ops = variable_get('node_options_voip_extension', false);
    dsm($ops);
  }
}
// */
