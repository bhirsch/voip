<?php

include_once('voipcall.features.inc');

/**
 * Save voipcall nodes. 
 * 
 * @param 
 *  $details, array
 *  $details = array (
 *    'destination' => '555 555 5555',   // destination number for phone call                       (required)
 *    'script' => $sid,                  // node id of script to use for this call                  (required) 
 *    'caller number' => '666 666 6666', // number to appear on recipient's phone as origin of call (optional)
 *    'caller name' => '555 555 5555',   // name to appear on recipient's caller ID                 (optional) 
 *    'parent node' => $nid,             // node creating this node (e.g. a callblast node)         (optional)
 *    'scheduled start' => $datestamp,   // unix timestamp of scheduled call time                   (optional)
 *     TODO add other optional params here, e.g. uid, sticky, moderate, promoted, title, etc.
 *  );
 * 
 * @return
 *  $nid, integer, node id of newly saved voipcall node.
 */
function voipcall_save($details) {
  $node = new stdClass();

  // values for all voipcall nodes generated by voipcall_save()
  $node->type = 'voipcall';
  $node->title = checkplain($details['destination']);
  $node->field_voipcall_status[0]['value'] = t('not called'); // TODO how will translation function impact this? 
  $node->field_voipcall_call_id[0]['value'] = uniqid();

  // user/module defined values
  // required:
  $node->field_voipcall_dest_number[0]['value'] = $details['destination'];
  $node->field_voipcall_script[0]['nid'] =  $details['script'];
  // optional:
  $node->field_voipcall_parent_nid[0]['value'] = $details['parent node'];
  $node->field_voipcall_caller_number [0]['value'] = $details['caller number'];
  $node->field_voipcall_callerid_name[0]['value'] = $details['caller name'];
  $node->field_voipcall_scheduled_start[0]['value'] = $details['schedled start'];

  $node = node_save($node);

  return $node;
}
